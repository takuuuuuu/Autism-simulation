# Memoryæ–‡æœ¬åµŒå…¥ä½¿ç”¨çš„Transformeræ¨¡å‹

## ç­”æ¡ˆï¼šæ˜¯çš„ï¼Œä½¿ç”¨äº†Transformerï¼

### ä»£ç å®ç°

åœ¨ `Simulation_setup.py` ä¸­ï¼š

```python
import sentence_transformers

# ä½¿ç”¨ SentenceTransformer æ¨¡å‹
st_model = sentence_transformers.SentenceTransformer(
    'sentence-transformers/all-mpnet-base-v2')

# embedder å‡½æ•°ï¼šå°†æ–‡æœ¬è½¬æ¢ä¸ºå‘é‡
embedder = lambda x: st_model.encode(x, show_progress_bar=False)
```

---

## è¯¦ç»†è§£é‡Š

### 1. SentenceTransformer æ˜¯ä»€ä¹ˆï¼Ÿ

**SentenceTransformer** æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºç”Ÿæˆå¥å­çº§åˆ«åµŒå…¥å‘é‡çš„åº“ï¼Œå®ƒåŸºäº **Transformer æ¶æ„**ã€‚

### 2. ä½¿ç”¨çš„æ¨¡å‹ï¼š`all-mpnet-base-v2`

- **æ¨¡å‹åç§°**ï¼š`sentence-transformers/all-mpnet-base-v2`
- **æ¶æ„**ï¼šåŸºäº **MPNet**ï¼ˆMasked and Permuted Pre-training for Language Understandingï¼‰
- **ç‰¹ç‚¹**ï¼š
  - ä¸“é—¨ä¸ºå¥å­åµŒå…¥ä»»åŠ¡è®­ç»ƒ
  - èƒ½å¤Ÿç†è§£å¥å­çš„è¯­ä¹‰
  - ç”Ÿæˆ768ç»´çš„å‘é‡
  - åœ¨è¯­ä¹‰ç›¸ä¼¼åº¦ä»»åŠ¡ä¸Šè¡¨ç°ä¼˜ç§€

### 3. Transformer æ¶æ„

**Transformer** æ˜¯æ·±åº¦å­¦ä¹ çš„æ ¸å¿ƒæ¶æ„ï¼ŒåŒ…æ‹¬ï¼š

```
è¾“å…¥æ–‡æœ¬
    â†“
Tokenizationï¼ˆåˆ†è¯ï¼‰
    â†“
Embedding Layerï¼ˆè¯åµŒå…¥ï¼‰
    â†“
Transformer Encoderï¼ˆç¼–ç å™¨ï¼‰
    â”œâ”€â”€ Multi-Head Attentionï¼ˆå¤šå¤´æ³¨æ„åŠ›ï¼‰
    â”œâ”€â”€ Feed Forward Networkï¼ˆå‰é¦ˆç½‘ç»œï¼‰
    â””â”€â”€ Layer Normalizationï¼ˆå±‚å½’ä¸€åŒ–ï¼‰
    â†“
Pooling Layerï¼ˆæ± åŒ–å±‚ï¼‰
    â†“
è¾“å‡ºå‘é‡ï¼ˆ768ç»´ï¼‰
```

### 4. å·¥ä½œæµç¨‹

```python
# å½“ä½ è°ƒç”¨ embedder("Sheldon likes dinosaurs")

1. æ–‡æœ¬è¾“å…¥ï¼š"Sheldon likes dinosaurs"

2. SentenceTransformerå¤„ç†ï¼š
   - Tokenization: å°†æ–‡æœ¬åˆ†æˆtokens
   - Transformerç¼–ç : é€šè¿‡å¤šå±‚Transformerç¼–ç å™¨
   - è¯­ä¹‰ç†è§£: ç†è§£å¥å­çš„æ•´ä½“å«ä¹‰
   - æ± åŒ–: å°†tokençº§åˆ«çš„è¡¨ç¤ºèšåˆæˆå¥å­çº§åˆ«çš„è¡¨ç¤º

3. è¾“å‡ºå‘é‡: [0.23, -0.15, 0.67, ..., 0.42] (768ä¸ªæ•°å­—)
```

---

## ä¸ºä»€ä¹ˆä½¿ç”¨Transformerï¼Ÿ

### âœ… ä¼˜ç‚¹ï¼š

1. **è¯­ä¹‰ç†è§£èƒ½åŠ›å¼º**
   - èƒ½ç†è§£"çŒ«"å’Œ"feline"æ˜¯ç›¸å…³çš„
   - èƒ½ç†è§£"å–œæ¬¢"å’Œ"è®¨åŒ"æ˜¯ç›¸åçš„
   - èƒ½ç†è§£ä¸Šä¸‹æ–‡å…³ç³»

2. **ç”Ÿæˆé«˜è´¨é‡çš„åµŒå…¥**
   - ç›¸ä¼¼æ„æ€çš„å¥å­ä¼šæœ‰ç›¸ä¼¼çš„å‘é‡
   - ä¸åŒæ„æ€çš„å¥å­ä¼šæœ‰ä¸åŒçš„å‘é‡
   - å‘é‡ä¹‹é—´çš„è·ç¦»åæ˜ è¯­ä¹‰ç›¸ä¼¼åº¦

3. **é¢„è®­ç»ƒæ¨¡å‹**
   - åœ¨å¤§è§„æ¨¡æ–‡æœ¬ä¸Šé¢„è®­ç»ƒ
   - å·²ç»å­¦ä¼šäº†è¯­è¨€çš„é€šç”¨æ¨¡å¼
   - å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œæ— éœ€ä»å¤´è®­ç»ƒ

### ğŸ“Š æ€§èƒ½ç‰¹ç‚¹ï¼š

- **å‘é‡ç»´åº¦**ï¼š768ç»´
- **æ¨¡å‹å¤§å°**ï¼šçº¦420MB
- **é€Ÿåº¦**ï¼šåœ¨CPUä¸Šå¤„ç†ä¸€ä¸ªå¥å­çº¦éœ€å‡ æ¯«ç§’
- **å‡†ç¡®åº¦**ï¼šåœ¨è¯­ä¹‰ç›¸ä¼¼åº¦ä»»åŠ¡ä¸Šè¡¨ç°ä¼˜ç§€

---

## ä¸å…¶ä»–æ–¹æ³•çš„å¯¹æ¯”

### ä¼ ç»Ÿæ–¹æ³•ï¼ˆä¸ä½¿ç”¨Transformerï¼‰ï¼š

```
è¯è¢‹æ¨¡å‹ï¼ˆBag of Wordsï¼‰ï¼š
- "Sheldon likes dinosaurs" â†’ [1, 0, 1, 0, 1, ...]
- åªè€ƒè™‘è¯é¢‘ï¼Œä¸è€ƒè™‘è¯­ä¹‰
- "å–œæ¬¢"å’Œ"è®¨åŒ"å¯èƒ½è¢«ç¼–ç æˆç›¸ä¼¼çš„å‘é‡
```

### Transformeræ–¹æ³•ï¼ˆå½“å‰ä½¿ç”¨ï¼‰ï¼š

```
SentenceTransformerï¼š
- "Sheldon likes dinosaurs" â†’ [0.23, -0.15, 0.67, ...]
- ç†è§£æ•´ä½“è¯­ä¹‰
- "å–œæ¬¢"å’Œ"è®¨åŒ"ä¼šè¢«ç¼–ç æˆä¸åŒçš„å‘é‡
- ç›¸ä¼¼æ„æ€çš„å¥å­ä¼šæœ‰ç›¸ä¼¼çš„å‘é‡
```

---

## å®é™…åº”ç”¨

### åœ¨Memoryç³»ç»Ÿä¸­çš„ä½¿ç”¨ï¼š

```python
# 1. æ·»åŠ è®°å¿†æ—¶
mem.add("Sheldon likes dinosaurs")
# å†…éƒ¨è°ƒç”¨ï¼šembedder("Sheldon likes dinosaurs")
# ç”Ÿæˆå‘é‡å¹¶å­˜å‚¨

# 2. æ£€ç´¢è®°å¿†æ—¶
mem.retrieve(query="What does Sheldon like?")
# å†…éƒ¨è¿‡ç¨‹ï¼š
# - embedder("What does Sheldon like?") â†’ æŸ¥è¯¢å‘é‡
# - è®¡ç®—æŸ¥è¯¢å‘é‡ä¸æ‰€æœ‰è®°å¿†å‘é‡çš„ç›¸ä¼¼åº¦
# - è¿”å›æœ€ç›¸ä¼¼çš„è®°å¿†
```

### ç›¸ä¼¼åº¦è®¡ç®—ï¼š

```python
# ä½¿ç”¨ä½™å¼¦ç›¸ä¼¼åº¦
similarity = cosine_similarity(
    query_vector,      # æŸ¥è¯¢çš„å‘é‡
    memory_vector      # è®°å¿†çš„å‘é‡
)

# ç›¸ä¼¼åº¦è¶Šé«˜ï¼Œè¯´æ˜è®°å¿†è¶Šç›¸å…³
```

---

## æ€»ç»“

âœ… **æ˜¯çš„ï¼Œä½¿ç”¨äº†Transformer**

- **åº“**ï¼š`sentence-transformers`
- **æ¨¡å‹**ï¼š`all-mpnet-base-v2`ï¼ˆåŸºäºMPNetæ¶æ„ï¼‰
- **æ¶æ„**ï¼šTransformer Encoder
- **è¾“å‡º**ï¼š768ç»´å‘é‡
- **ç”¨é€”**ï¼šå°†æ–‡æœ¬è½¬æ¢ä¸ºè¯­ä¹‰å‘é‡ï¼Œç”¨äºè®°å¿†æ£€ç´¢

### å…³é”®ç‚¹ï¼š

1. **Transformeræ¶æ„**ï¼šä½¿ç”¨è‡ªæ³¨æ„åŠ›æœºåˆ¶ç†è§£æ–‡æœ¬è¯­ä¹‰
2. **é¢„è®­ç»ƒæ¨¡å‹**ï¼šåœ¨å¤§è§„æ¨¡æ•°æ®ä¸Šé¢„è®­ç»ƒï¼Œç†è§£è¯­è¨€æ¨¡å¼
3. **å¥å­çº§åˆ«åµŒå…¥**ï¼šç”Ÿæˆæ•´ä¸ªå¥å­çš„å‘é‡è¡¨ç¤ºï¼Œè€Œä¸æ˜¯å•ä¸ªè¯
4. **è¯­ä¹‰ç›¸ä¼¼åº¦**ï¼šèƒ½å¤Ÿæ‰¾åˆ°æ„æ€ç›¸è¿‘ä½†è¡¨è¾¾ä¸åŒçš„æ–‡æœ¬

è¿™å°±æ˜¯ä¸ºä»€ä¹ˆç³»ç»Ÿèƒ½å¤Ÿæ™ºèƒ½åœ°æ£€ç´¢ç›¸å…³è®°å¿†ï¼Œå³ä½¿æŸ¥è¯¢å’Œè®°å¿†çš„ç”¨è¯ä¸å®Œå…¨ç›¸åŒï¼

